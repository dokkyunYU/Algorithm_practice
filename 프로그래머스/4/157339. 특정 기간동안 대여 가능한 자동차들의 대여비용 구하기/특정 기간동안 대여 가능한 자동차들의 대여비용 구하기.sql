-- 코드를 입력하세요
SELECT A.CAR_ID, A.CAR_TYPE, ROUND(30 * DAILY_FEE * (1 - DISCOUNT_RATE)) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
# JOIN (
#     
# ) B ON A.CAR_ID = B.CAR_ID
JOIN (
    SELECT CAR_TYPE, DISCOUNT_RATE / 100 AS DISCOUNT_RATE
    FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN
    WHERE DURATION_TYPE LIKE "30%"
        AND CAR_TYPE IN ("세단", "SUV")
) C ON A.CAR_TYPE = C.CAR_TYPE
WHERE 30 * DAILY_FEE * (1 - DISCOUNT_RATE) BETWEEN 500000 AND 1999999
AND A.CAR_ID NOT IN (
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE (START_DATE BETWEEN "2022-11-01 00:00:00" AND "2022-11-30 23:59:59"
        OR END_DATE BETWEEN "2022-11-01 00:00:00" AND "2022-11-30 23:59:59"
        OR (START_DATE < "2022-11-01 00:00:00" AND END_DATE > "2022-11-30 23:59:59"))
)
ORDER BY FEE DESC,
    CAR_TYPE ASC,
    CAR_ID DESC;